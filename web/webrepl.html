<!doctype html> <html> <head> <title>MicroPython WebREPL</title> <style> html{ background:#555;}h1{ margin-bottom:20px;font:20px/1.5 sans-serif;} .file-box{ margin:4px;padding:4px;background:#888;}</style> <script>(function(){"use strict";function t(){this._events=this._events||{}}function s(){t.call(this)}function e(t){var i=this;if(!(this instanceof e))return new e(arguments[0],arguments[1],arguments[2]);s.call(this),"number"==typeof t&&(t={cols:arguments[0],rows:arguments[1],handler:arguments[2]}),t=t||{},p(u(e.defaults),function(s){null==t[s]&&(t[s]=e.options[s],e[s]!==e.defaults[s]&&(t[s]=e[s])),i[s]=t[s]}),8===t.colors.length?t.colors=t.colors.concat(e._colors.slice(8)):16===t.colors.length?t.colors=t.colors.concat(e._colors.slice(16)):10===t.colors.length?t.colors=t.colors.slice(0,-2).concat(e._colors.slice(8,-2),t.colors.slice(-2)):18===t.colors.length&&(t.colors=t.colors.slice(0,-2).concat(e._colors.slice(16,-2),t.colors.slice(-2))),this.colors=t.colors,this.options=t,this.parent=t.body||t.parent||(y?y.getElementsByTagName("body")[0]:null),this.cols=t.cols||t.geometry[0],this.rows=t.rows||t.geometry[1],this.setRawMode,this.isTTY=!0,this.isRaw=!0,this.columns=this.cols,this.rows=this.rows,t.handler&&this.on("data",t.handler),this.ybase=0,this.ydisp=0,this.x=0,this.y=0,this.cursorState=0,this.cursorHidden=!1,this.convertEol,this.state=0,this.queue="",this.scrollTop=0,this.scrollBottom=this.rows-1,this.applicationKeypad=!1,this.applicationCursor=!1,this.originMode=!1,this.insertMode=!1,this.wraparoundMode=!1,this.normal=null,this.prefixMode=!1,this.selectMode=!1,this.visualMode=!1,this.searchMode=!1,this.searchDown,this.entry="",this.entryPrefix="Search: ",this._real,this._selected,this._textarea,this.charset=null,this.gcharset=null,this.glevel=0,this.charsets=[null],this.decLocator,this.x10Mouse,this.vt200Mouse,this.vt300Mouse,this.normalMouse,this.mouseEvents,this.sendFocus,this.utfMouse,this.sgrMouse,this.urxvtMouse,this.element,this.children,this.refreshStart,this.refreshEnd,this.savedX,this.savedY,this.savedCols,this.readable=!0,this.writable=!0,this.defAttr=131840,this.curAttr=this.defAttr,this.params=[],this.currentParam=0,this.prefix="",this.postfix="",this.lines=[];for(var r=this.rows;r--;)this.lines.push(this.blankLine());this.tabs,this.setupStops()}function i(t,s,e,i){t.addEventListener(s,e,i||!1)}function r(t,s,e,i){t.removeEventListener(s,e,i||!1)}function h(t){return t.preventDefault&&t.preventDefault(),t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,!1}function o(t,s){function e(){this.constructor=t}e.prototype=s.prototype,t.prototype=new e}function a(t){var s=t.getElementsByTagName("body")[0],e=t.createElement("div");e.className="terminal";var i=t.createElement("div"),r=t.createElement("span");r.innerHTML="hello world",i.appendChild(r),e.appendChild(i),s.appendChild(e);var h=r.scrollWidth;r.style.fontWeight="bold";var o=r.scrollWidth;return s.removeChild(e),h!==o}function n(t,s){for(var e=t.length;e--;)if(t[e]===s)return e;return-1}function c(t){return!(t<="ÔºÄ")&&(t>="ÔºÅ"&&t<="Ôææ"||t>="ÔøÇ"&&t<="Ôøá"||t>="Ôøä"&&t<="Ôøè"||t>="Ôøí"&&t<="Ôøó"||t>="Ôøö"&&t<="Ôøú"||t>="Ôø†"&&t<="Ôø¶"||t>="Ôø®"&&t<="ÔøÆ")}function l(t,s,i){var r=t<<16|s<<8|i;if(null!=l._cache[r])return l._cache[r];for(var h,o,a,n,c,p=1/0,u=-1,f=0;f<e.vcolors.length;f++){if(h=e.vcolors[f],o=h[0],a=h[1],n=h[2],c=l.distance(t,s,i,o,a,n),0===c){u=f;break}c<p&&(p=c,u=f)}return l._cache[r]=u}function p(t,s,e){if(t.forEach)return t.forEach(s,e);for(var i=0;i<t.length;i++)s.call(e,t[i],i,t)}function u(t){if(Object.keys)return Object.keys(t);var s,e=[];for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s);return e}var f=this,y=this.document;t.prototype.addListener=function(t,s){this._events[t]=this._events[t]||[],this._events[t].push(s)},t.prototype.on=t.prototype.addListener,t.prototype.removeListener=function(t,s){if(this._events[t])for(var e=this._events[t],i=e.length;i--;)if(e[i]===s||e[i].listener===s)return void e.splice(i,1)},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(t){this._events[t]&&delete this._events[t]},t.prototype.once=function(t,s){function e(){var i=Array.prototype.slice.call(arguments);return this.removeListener(t,e),s.apply(this,i)}return e.listener=s,this.on(t,e)},t.prototype.emit=function(t){if(this._events[t])for(var s=Array.prototype.slice.call(arguments,1),e=this._events[t],i=e.length,r=0;r<i;r++)e[r].apply(this,s)},t.prototype.listeners=function(t){return this._events[t]=this._events[t]||[]},o(s,t),s.prototype.pipe=function(t,s){function e(){o.removeListener("data",i),o.removeListener("error",r),o.removeListener("end",h),t.removeListener("error",r),t.removeListener("close",e)}var i,r,h,o=this;return o.on("data",i=function(s){t.write(s)}),o.on("error",r=function(t){if(e(),!this.listeners("error").length)throw t}),o.on("end",h=function(){t.end(),e()}),t.on("error",r),t.on("close",e),t.emit("pipe",o),t};var d=0,b=1,m=2,v=3,x=4,k=5,g=6,w={type:"udk"};o(e,s),e.tangoColors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"],e.xtermColors=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"],e.colors=function(){function t(t,e,i){r.push("#"+s(t)+s(e)+s(i))}function s(t){return t=t.toString(16),t.length<2?"0"+t:t}var i,r=e.tangoColors.slice(),h=[0,95,135,175,215,255];for(i=0;i<216;i++)t(h[i/36%6|0],h[i/6%6|0],h[i%6]);for(i=0;i<24;i++)h=8+10*i,t(h,h,h);return r}(),e.colors[256]="#000000",e.colors[257]="#f0f0f0",e._colors=e.colors.slice(),e.vcolors=function(){for(var t,s=[],i=e.colors,r=0;r<256;r++)t=parseInt(i[r].substring(1),16),s.push([t>>16&255,t>>8&255,255&t]);return s}(),e.defaults={colors:e.colors,convertEol:!1,termName:"xterm",geometry:[80,24],cursorBlink:!0,visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,useStyle:!1},e.options={},p(u(e.defaults),function(t){e[t]=e.defaults[t],e.options[t]=e.defaults[t]}),e.focus=null,e.prototype.focus=function(){e.focus!==this&&(e.focus&&e.focus.blur(),this.sendFocus&&this.send("[I"),this.showCursor(),e.focus=this)},e.prototype.blur=function(){e.focus===this&&(this.cursorState=0,this.refresh(this.y,this.y),this.sendFocus&&this.send("[O"),e.focus=null)},e.prototype.initGlobal=function(){var t=this.document;e._boundDocs=e._boundDocs||[],~n(e._boundDocs,t)||(e._boundDocs.push(t),e.bindPaste(t),e.bindKeys(t),e.bindCopy(t),this.isMobile&&this.fixMobile(t),this.useStyle&&e.insertStyle(t,this.colors[256],this.colors[257]))},e.bindPaste=function(t){var s=t.defaultView;i(s,"paste",function(t){var s=e.focus;if(s)return t.clipboardData?s.send(t.clipboardData.getData("text/plain")):s.context.clipboardData&&s.send(s.context.clipboardData.getData("Text")),s.element.contentEditable="inherit",h(t)})},e.bindKeys=function(t){i(t,"keydown",function(t){if(e.focus){var s=t.target||t.srcElement;if(s)return s===e.focus.element||s===e.focus.context||s===e.focus.document||s===e.focus.body||s===e._textarea||s===e.focus.parent?e.focus.keyDown(t):void 0}},!0),i(t,"keypress",function(t){if(e.focus){var s=t.target||t.srcElement;if(s&&(!t.ctrlKey||"v"!==t.key))return s===e.focus.element||s===e.focus.context||s===e.focus.document||s===e.focus.body||s===e._textarea||s===e.focus.parent?(e.focus.element.contentEditable="inherit",e.focus.keyPress(t)):void 0}},!0),i(t,"mousedown",function(t){if(e.focus){var s=t.target||t.srcElement;if(s){do if(s===e.focus.element)return;while(s=s.parentNode);e.focus.blur()}}})},e.bindCopy=function(t){var s=t.defaultView;i(s,"copy",function(t){var s=e.focus;if(s&&s._selected){var i=s.getCopyTextarea(),r=s.grabText(s._selected.x1,s._selected.x2,s._selected.y1,s._selected.y2);s.emit("copy",r),i.focus(),i.textContent=r,i.value=r,i.setSelectionRange(0,r.length),C(function(){s.element.focus(),s.focus()},1)}})},e.prototype.fixMobile=function(t){var s=this,r=t.createElement("textarea");r.style.position="absolute",r.style.left="-32000px",r.style.top="-32000px",r.style.width="0px",r.style.height="0px",r.style.opacity="0",r.style.backgroundColor="transparent",r.style.borderStyle="none",r.style.outlineStyle="none",r.autocapitalize="none",r.autocorrect="off",t.getElementsByTagName("body")[0].appendChild(r),e._textarea=r,C(function(){r.focus()},1e3),this.isAndroid&&i(r,"change",function(){var t=r.textContent||r.value;r.value="",r.textContent="",s.send(t+"\r")})},e.insertStyle=function(t,s,e){var i=t.getElementById("term-style");if(!i){var r=t.getElementsByTagName("head")[0];if(r){var i=t.createElement("style");i.id="term-style",i.innerHTML=".terminal {\n float: left;\n border: "+s+' solid 5px;\n font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n font-size: 11px;\n color: '+e+";\n background: "+s+";\n}\n\n.terminal-cursor {\n color: "+s+";\n background: "+e+";\n}\n",r.insertBefore(i,r.firstChild)}}},e.prototype.open=function(t){var s,r=this,h=0;if(this.parent=t||this.parent,!this.parent)throw new Error("Terminal requires a parent element.");for(this.context=this.parent.ownerDocument.defaultView,this.document=this.parent.ownerDocument,this.body=this.document.getElementsByTagName("body")[0],this.context.navigator&&this.context.navigator.userAgent&&(this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac"),this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad"),this.isIphone=!!~this.context.navigator.userAgent.indexOf("iPhone"),this.isAndroid=!!~this.context.navigator.userAgent.indexOf("Android"),this.isMobile=this.isIpad||this.isIphone||this.isAndroid,this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE"),this.isFirefox=!!~this.context.navigator.userAgent.indexOf("Firefox")),this.element=this.document.createElement("div"),this.element.className="terminal",this.element.style.outline="none",this.element.setAttribute("tabindex",0),this.element.setAttribute("spellcheck","false"),this.element.style.backgroundColor=this.colors[256],this.element.style.color=this.colors[257],this.children=[];h<this.rows;h++)s=this.document.createElement("div"),this.element.appendChild(s),this.children.push(s);this.parent.appendChild(this.element),this.refresh(0,this.rows-1),"useEvents"in this.options&&!this.options.useEvents||this.initGlobal(),"useFocus"in this.options&&!this.options.useFocus||(this.focus(),this.startBlink(),i(this.element,"focus",function(){r.focus(),r.isMobile&&e._textarea.focus()}),i(this.element,"mousedown",function(){r.focus()}),i(this.element,"mousedown",function(t){var s=null!=t.button?+t.button:null!=t.which?t.which-1:null;return r.isMSIE&&(s=1===s?0:4===s?1:s),1!==s&&2!==s?void(r.element.contentEditable="inherit"):(r.element.contentEditable="true",r.isFirefox&&f.getSelection().collapse(r.element,0),void(r.isFirefox||C(function(){r.element.contentEditable="inherit"},1)))},!0)),"useMouse"in this.options&&!this.options.useMouse||this.bindMouse(),"useFocus"in this.options&&!this.options.useFocus||C(function(){r.element.focus()},100),null==e.brokenBold&&(e.brokenBold=a(this.document)),this.emit("open")},e.prototype.setRawMode=function(t){this.isRaw=!!t},e.prototype.bindMouse=function(){function t(t){var s,e;if(s=a(t),e=n(t))switch(o(s,e),t.type){case"mousedown":p=s;break;case"mouseup":p=32;break;case u:}}function s(t){var s,e=p;s=n(t),s&&(e+=32,o(e,s))}function e(t,s){if(l.utfMouse){if(2047===s)return t.push(0);s<127?t.push(s):(s>2047&&(s=2047),t.push(192|s>>6),t.push(128|63&s))}else{if(255===s)return t.push(0);s>127&&(s=127),t.push(s)}}function o(t,s){if(l.vt300Mouse){t&=3,s.x-=32,s.y-=32;var i="[24";if(0===t)i+="1";else if(1===t)i+="3";else if(2===t)i+="5";else{if(3===t)return;i+="0"}return i+="~["+s.x+","+s.y+"]\r",void l.send(i)}if(l.decLocator)return t&=3,s.x-=32,s.y-=32,0===t?t=2:1===t?t=4:2===t?t=6:3===t&&(t=3),void l.send("["+t+";"+(3===t?4:0)+";"+s.y+";"+s.x+";"+(s.page||0)+"&w");if(l.urxvtMouse)return s.x-=32,s.y-=32,s.x++,s.y++,void l.send("["+t+";"+s.x+";"+s.y+"M");if(l.sgrMouse)return s.x-=32,s.y-=32,void l.send("[<"+(3===(3&t)?t&-4:t)+";"+s.x+";"+s.y+(3===(3&t)?"m":"M"));var i=[];e(i,t),e(i,s.x),e(i,s.y),l.send("[M"+M.fromCharCode.apply(M,i))}function a(t){var s,e,i,r,h;switch(t.type){case"mousedown":s=null!=t.button?+t.button:null!=t.which?t.which-1:null,l.isMSIE&&(s=1===s?0:4===s?1:s);break;case"mouseup":s=3;break;case"DOMMouseScroll":s=t.detail<0?64:65;break;case"mousewheel":s=t.wheelDeltaY>0?64:65}return e=t.shiftKey?4:0,i=t.metaKey?8:0,r=t.ctrlKey?16:0,h=e|i|r,l.vt200Mouse?h&=r:l.normalMouse||(h=0),s=32+(h<<2)+s}function n(t){var s,e,i,r,h;if(null!=t.pageX){for(s=t.pageX,e=t.pageY,h=l.element;h&&h!==l.document.documentElement;)s-=h.offsetLeft,e-=h.offsetTop,h="offsetParent"in h?h.offsetParent:h.parentNode;return i=l.element.clientWidth,r=l.element.clientHeight,s=Math.round(s/i*l.cols),e=Math.round(e/r*l.rows),s<0&&(s=0),s>l.cols&&(s=l.cols),e<0&&(e=0),e>l.rows&&(e=l.rows),s+=32,e+=32,{x:s,y:e,type:t.type===u?"mousewheel":t.type}}}var c=this.element,l=this,p=32,u="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";i(c,"mousedown",function(e){if(l.mouseEvents)return t(e),l.focus(),l.normalMouse&&i(l.document,"mousemove",s),l.x10Mouse||i(l.document,"mouseup",function e(i){return t(i),l.normalMouse&&r(l.document,"mousemove",s),r(l.document,"mouseup",e),h(i)}),h(e)}),i(c,u,function(s){if(l.mouseEvents&&!(l.x10Mouse||l.vt300Mouse||l.decLocator))return t(s),h(s)}),i(c,u,function(t){if(!l.mouseEvents&&!l.applicationKeypad)return"DOMMouseScroll"===t.type?l.scrollDisp(t.detail<0?-5:5):l.scrollDisp(t.wheelDeltaY>0?-5:5),h(t)})},e.prototype.close=e.prototype.destroySoon=e.prototype.destroy=function(){this.destroyed||(this._blink&&(clearInterval(this._blink),delete this._blink),this.readable=!1,this.writable=!1,this.destroyed=!0,this._events={},this.handler=function(){},this.write=function(){},this.end=function(){},this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.emit("end"),this.emit("close"),this.emit("finish"),this.emit("destroy"))},e.prototype.refresh=function(t,s){var i,r,h,o,a,n,l,p,u,f,y,d,b,m;for(s-t>=this.rows/2&&(m=this.element.parentNode,m&&m.removeChild(this.element)),l=this.cols,r=t,s>=this.lines.length&&(this.log("`end` is too large. Most likely a bad CSR."),s=this.lines.length-1);r<=s;r++){for(b=r+this.ydisp,o=this.lines[b],a="",i=r!==this.y||!this.cursorState||this.ydisp!==this.ybase&&!this.selectMode||this.cursorHidden?-1:this.x,u=this.defAttr,h=0;h<l;h++){switch(p=o[h][0],n=o[h][1],h===i&&(p=-1),p!==u&&(u!==this.defAttr&&(a+="</span>"),p!==this.defAttr&&(p===-1?a+='<span class="reverse-video terminal-cursor">':(a+='<span style="',f=511&p,y=p>>9&511,d=p>>18,1&d&&(e.brokenBold||(a+="font-weight:bold;"),y<8&&(y+=8)),2&d&&(a+="text-decoration:underline;"),4&d&&(2&d?(a=a.slice(0,-1),a+=" blink;"):a+="text-decoration:blink;"),8&d&&(f=p>>9&511,y=511&p,1&d&&y<8&&(y+=8)),16&d&&(a+="visibility:hidden;"),256!==f&&(a+="background-color:"+this.colors[f]+";"),257!==y&&(a+="color:"+this.colors[y]+";"),a+='">'))),n){case"&":a+="&amp;";break;case"<":a+="&lt;";break;case">":a+="&gt;";break;default:n<=" "?a+="&nbsp;":(c(n)&&h++,a+=n)}u=p}u!==this.defAttr&&(a+="</span>"),this.children[r].innerHTML=a}m&&m.appendChild(this.element)},e.prototype._cursorBlink=function(){e.focus===this&&(this.cursorState^=1,this.refresh(this.y,this.y))},e.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))},e.prototype.startBlink=function(){if(this.cursorBlink){var t=this;this._blinker=function(){t._cursorBlink()},this._blink=S(this._blinker,500)}},e.prototype.refreshBlink=function(){this.cursorBlink&&this._blink&&(clearInterval(this._blink),this._blink=S(this._blinker,500))},e.prototype.scroll=function(){var t;++this.ybase===this.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1)),this.ydisp=this.ybase,t=this.ybase+this.rows-1,t-=this.rows-1-this.scrollBottom,t===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(t,0,this.blankLine()),0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1)),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},e.prototype.scrollDisp=function(t){this.ydisp+=t,this.ydisp>this.ybase?this.ydisp=this.ybase:this.ydisp<0&&(this.ydisp=0),this.refresh(0,this.rows-1)},e.prototype.write=function(t){var s,i,r,h=t.length,o=0;for(this.refreshStart=this.y,this.refreshEnd=this.y,this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.maxRange());o<h;o++,this.lch=r)switch(r=t[o],this.state){case d:switch(r){case"":this.bell();break;case"\n":case"\v":case"\f":this.convertEol&&(this.x=0),this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());break;case"\r":this.x=0;break;case"\b":this.x>0&&this.x--;break;case"\t":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=b;break;default:if(r>=" "&&(this.charset&&this.charset[r]&&(r=this.charset[r]),this.x>=this.cols&&(this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll())),this.lines[this.y+this.ybase][this.x]=[this.curAttr,r],this.x++,this.updateRange(this.y),c(r))){if(s=this.y+this.ybase,this.cols<2||this.x>=this.cols){this.lines[s][this.x-1]=[this.curAttr," "];break}this.lines[s][this.x]=[this.curAttr," "],this.x++}}break;case b:switch(r){case"[":this.params=[],this.currentParam=0,this.state=m;break;case"]":this.params=[],this.currentParam=0,this.state=v;break;case"P":this.params=[],this.prefix="",this.currentParam="",this.state=k;break;case"_":this.state=g;break;case"^":this.state=g;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0),this.setgCharset(0,e.charsets.US),this.state=d,o++;break;case"(":case")":case"*":case"+":case"-":case".":switch(r){case"(":this.gcharset=0;break;case")":this.gcharset=1;break;case"*":this.gcharset=2;break;case"+":this.gcharset=3;break;case"-":this.gcharset=1;break;case".":this.gcharset=2}this.state=x;break;case"/":this.gcharset=3,this.state=x,o--;break;case"N":break;case"O":break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor(),this.state=d;break;case"8":this.restoreCursor(),this.state=d;break;case"#":this.state=d,o++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad."),this.applicationKeypad=!0,this.state=d;break;case">":this.log("Switching back to normal keypad."),this.applicationKeypad=!1,this.state=d;break;default:this.state=d,this.error("Unknown ESC control: %s.",r)}break;case x:switch(r){case"0":i=e.charsets.SCLD;break;case"A":i=e.charsets.UK;break;case"B":i=e.charsets.US;break;case"4":i=e.charsets.Dutch;break;case"C":case"5":i=e.charsets.Finnish;break;case"R":i=e.charsets.French;break;case"Q":i=e.charsets.FrenchCanadian;break;case"K":i=e.charsets.German;break;case"Y":i=e.charsets.Italian;break;case"E":case"6":i=e.charsets.NorwegianDanish;break;case"Z":i=e.charsets.Spanish;break;case"H":case"7":i=e.charsets.Swedish;break;case"=":i=e.charsets.Swiss;break;case"/":i=e.charsets.ISOLatin,o++;break;default:i=e.charsets.US}this.setgCharset(this.gcharset,i),this.gcharset=null,this.state=d;break;case v:if(""===this.lch&&"\\"===r||""===r){switch(""===this.lch&&("string"==typeof this.currentParam?this.currentParam=this.currentParam.slice(0,-1):"number"==typeof this.currentParam&&(this.currentParam=(this.currentParam-("".charCodeAt(0)-48))/10)),this.params.push(this.currentParam),this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1],this.handleTitle(this.title));break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:}this.params=[],this.currentParam=0,this.state=d}else this.params.length?this.currentParam+=r:r>="0"&&r<="9"?this.currentParam=10*this.currentParam+r.charCodeAt(0)-48:";"===r&&(this.params.push(this.currentParam),this.currentParam="");break;case m:if("?"===r||">"===r||"!"===r){this.prefix=r;break}if(r>="0"&&r<="9"){this.currentParam=10*this.currentParam+r.charCodeAt(0)-48;break}if("$"===r||'"'===r||" "===r||"'"===r){this.postfix=r;break}if(this.params.push(this.currentParam),this.currentParam=0,";"===r)break;switch(this.state=d,r){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":this.prefix||this.charAttributes(this.params);break;case"n":this.prefix||this.deviceStatus(this.params);break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":this.params.length<2&&!this.prefix&&this.scrollDown(this.params);break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",r)}this.prefix="",this.postfix="";break;case k:if(""===this.lch&&"\\"===r||""===r){if("tmux;"===this.prefix&&""===r){this.currentParam+=r;continue}""===this.lch&&("string"==typeof this.currentParam?this.currentParam=this.currentParam.slice(0,-1):"number"==typeof this.currentParam&&(this.currentParam=(this.currentParam-("".charCodeAt(0)-48))/10)),this.params.push(this.currentParam);var a=this.params[this.params.length-1];switch(this.prefix){case w:this.emit("udk",{clearAll:0===this.params[0],eraseBelow:1===this.params[0],lockKeys:0===this.params[1],dontLockKeys:1===this.params[1],keyList:(this.params[2]+"").split(";").map(function(t){return t=t.split("/"),{keyCode:t[0],hexKeyValue:t[1]}})});break;case"$q":var n=0;switch(a){case'"q':a='0"q',n=1;break;case'"p':a='61;0"p',n=1;break;case"r":a=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r",n=1;break;case"m":n=0;break;default:this.error("Unknown DCS Pt: %s.",a),n=0}this.send("P"+n+"$r"+a+"\\");break;case"+p":this.emit("set terminfo",{name:this.params[0]});break;case"+q":var n=!1;this.send("P"+ +n+"+r"+a+"\\");break;case"tmux;":this.emit("passthrough",a);break;default:this.error("Unknown DCS prefix: %s.",a)}this.currentParam=0,this.prefix="",this.state=d}else this.currentParam+=r,this.prefix||(/^\d*;\d*\|/.test(this.currentParam)?(this.prefix=w,this.params=this.currentParam.split(/[;|]/).map(function(t){return t.length?+t:0}).slice(0,-1),this.currentParam=""):(/^[$+][a-zA-Z]/.test(this.currentParam)||/^\w+;\x1b/.test(this.currentParam))&&(this.prefix=this.currentParam,this.currentParam=""));break;case g:(""===this.lch&&"\\"===r||""===r)&&(this.state=d)}return this.updateRange(this.y),this.refresh(this.refreshStart,this.refreshEnd),!0},e.prototype.writeln=function(t){return this.write(t+"\r\n")},e.prototype.end=function(t){var s=!0;return t&&(s=this.write(t)),this.destroySoon(),s},e.prototype.resume=function(){},e.prototype.pause=function(){},e.prototype.keyDown=function(t){var s,i=this;switch(t.keyCode){case 8:if(t.altKey){s="";break}if(t.shiftKey){s="\b";break}s="";break;case 9:if(t.shiftKey){s="[Z";break}s="\t";break;case 13:s="\r";break;case 27:s="";break;case 32:s=" ";break;case 37:if(this.applicationCursor){s="OD";break}if(t.ctrlKey){s="[5D";break}s="[D";break;case 39:if(this.applicationCursor){s="OC";break}if(t.ctrlKey){s="[5C";break}s="[C";break;case 38:if(this.applicationCursor){s="OA";break}if(t.ctrlKey)return this.scrollDisp(-1),h(t);s="[A";break;case 40:if(this.applicationCursor){s="OB";break}if(t.ctrlKey)return this.scrollDisp(1),h(t);s="[B";break;case 46:s="[3~";break;case 45:s="[2~";break;case 36:if(this.applicationKeypad){s="OH";break}s="OH";break;case 35:if(this.applicationKeypad){s="OF";break}s="OF";break;case 33:if(t.shiftKey)return this.scrollDisp(-(this.rows-1)),h(t);s="[5~";break;case 34:if(t.shiftKey)return this.scrollDisp(this.rows-1),h(t);s="[6~";break;case 112:s="OP";break;case 113:s="OQ";break;case 114:s="OR";break;case 115:s="OS";break;case 116:s="[15~";break;case 117:s="[17~";break;case 118:s="[18~";break;case 119:s="[19~";break;case 120:s="[20~";break;case 121:s="[21~";break;case 122:s="[23~";break;case 123:s="[24~";break;default:if(t.ctrlKey)if(t.keyCode>=65&&t.keyCode<=90){if(this.screenKeys&&!this.prefixMode&&!this.selectMode&&65===t.keyCode)return this.enterPrefix(),h(t);if(this.prefixMode&&86===t.keyCode){this.leavePrefix();var r=e.focus;return void(r.element.contentEditable="true")}if((this.prefixMode||this.selectMode)&&67===t.keyCode)return void(this.visualMode&&C(function(){i.leaveVisual()},1));s=M.fromCharCode(t.keyCode-64)}else 32===t.keyCode?s=M.fromCharCode(0):t.keyCode>=51&&t.keyCode<=55?s=M.fromCharCode(t.keyCode-51+27):56===t.keyCode?s=M.fromCharCode(127):219===t.keyCode?s=M.fromCharCode(27):221===t.keyCode&&(s=M.fromCharCode(29));else t.altKey&&(t.keyCode>=65&&t.keyCode<=90?s=""+M.fromCharCode(t.keyCode+32):192===t.keyCode?s="`":t.keyCode>=48&&t.keyCode<=57&&(s=""+(t.keyCode-48)))}return!s||(this.prefixMode?(this.leavePrefix(),h(t)):this.selectMode?(this.keySelect(t,s),h(t)):(this.emit("keydown",t),this.emit("key",s,t),this.showCursor(),this.handler(s),h(t)))},e.prototype.setgLevel=function(t){this.glevel=t,this.charset=this.charsets[t]},e.prototype.setgCharset=function(t,s){this.charsets[t]=s,this.glevel===t&&(this.charset=s)},e.prototype.keyPress=function(t){var s;if(h(t),t.charCode)s=t.charCode;else if(null==t.which)s=t.keyCode;else{if(0===t.which||0===t.charCode)return!1;s=t.which}return!(!s||t.ctrlKey||t.altKey||t.metaKey)&&(s=M.fromCharCode(s),this.prefixMode?(this.leavePrefix(),this.keyPrefix(t,s),!1):this.selectMode?(this.keySelect(t,s),!1):(this.emit("keypress",s,t),this.emit("key",s,t),this.showCursor(),this.handler(s),!1))},e.prototype.send=function(t){var s=this;this.queue||C(function(){s.handler(s.queue),s.queue=""},1),this.queue+=t},e.prototype.bell=function(){if(this.emit("bell"),this.visualBell){var t=this;this.element.style.borderColor="white",C(function(){t.element.style.borderColor=""},10),this.popOnBell&&this.focus()}},e.prototype.log=function(){if(this.debug&&this.context.console&&this.context.console.log){var t=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,t)}},e.prototype.error=function(){if(this.debug&&this.context.console&&this.context.console.error){var t=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,t)}},e.prototype.resize=function(t,s){var e,i,r,h,o;if(t<1&&(t=1),s<1&&(s=1),h=this.cols,h<t)for(o=[this.defAttr," "],r=this.lines.length;r--;)for(;this.lines[r].length<t;)this.lines[r].push(o);else if(h>t)for(r=this.lines.length;r--;)for(;this.lines[r].length>t;)this.lines[r].pop();if(this.setupStops(h),this.cols=t,this.columns=t,h=this.rows,h<s)for(i=this.element;h++<s;)this.lines.length<s+this.ybase&&this.lines.push(this.blankLine()),this.children.length<s&&(e=this.document.createElement("div"),i.appendChild(e),this.children.push(e));else if(h>s)for(;h-- >s;)if(this.lines.length>s+this.ybase&&this.lines.pop(),this.children.length>s){if(i=this.children.pop(),!i)continue;i.parentNode.removeChild(i)}this.rows=s,this.y>=s&&(this.y=s-1),this.x>=t&&(this.x=t-1),this.scrollTop=0,this.scrollBottom=s-1,this.refresh(0,this.rows-1),this.normal=null,this.emit("resize")},e.prototype.updateRange=function(t){t<this.refreshStart&&(this.refreshStart=t),t>this.refreshEnd&&(this.refreshEnd=t)},e.prototype.maxRange=function(){this.refreshStart=0,this.refreshEnd=this.rows-1},e.prototype.setupStops=function(t){for(null!=t?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this.cols;t+=8)this.tabs[t]=!0},e.prototype.prevStop=function(t){for(null==t&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this.cols?this.cols-1:t<0?0:t},e.prototype.nextStop=function(t){for(null==t&&(t=this.x);!this.tabs[++t]&&t<this.cols;);return t>=this.cols?this.cols-1:t<0?0:t},e.prototype.eraseAttr=function(){return this.defAttr&-512|511&this.curAttr},e.prototype.eraseRight=function(t,s){for(var e=this.lines[this.ybase+s],i=[this.eraseAttr()," "];t<this.cols;t++)e[t]=i;this.updateRange(s)},e.prototype.eraseLeft=function(t,s){var e=this.lines[this.ybase+s],i=[this.eraseAttr()," "];for(t++;t--;)e[t]=i;this.updateRange(s)},e.prototype.eraseLine=function(t){this.eraseRight(0,t)},e.prototype.blankLine=function(t){for(var s=t?this.eraseAttr():this.defAttr,e=[s," "],i=[],r=0;r<this.cols;r++)i[r]=e;return i},e.prototype.ch=function(t){return t?[this.eraseAttr()," "]:[this.defAttr," "]},e.prototype.is=function(t){var s=this.termName;return 0===(s+"").indexOf(t)},e.prototype.handler=function(t){this.emit("data",t)},e.prototype.handleTitle=function(t){this.emit("title",t)},e.prototype.index=function(){this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll()),this.state=d},e.prototype.reverseIndex=function(){var t;this.y--,this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),t=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-t+1,1),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)),this.state=d},e.prototype.reset=function(){this.options.rows=this.rows,this.options.cols=this.cols,e.call(this,this.options),this.refresh(0,this.rows-1)},e.prototype.tabSet=function(){this.tabs[this.x]=!0,this.state=d},e.prototype.cursorUp=function(t){var s=t[0];s<1&&(s=1),this.y-=s,this.y<0&&(this.y=0)},e.prototype.cursorDown=function(t){var s=t[0];s<1&&(s=1),this.y+=s,this.y>=this.rows&&(this.y=this.rows-1)},e.prototype.cursorForward=function(t){var s=t[0];s<1&&(s=1),this.x+=s,this.x>=this.cols&&(this.x=this.cols-1)},e.prototype.cursorBackward=function(t){var s=t[0];s<1&&(s=1),this.x-=s,this.x<0&&(this.x=0)},e.prototype.cursorPos=function(t){var s,e;s=t[0]-1,e=t.length>=2?t[1]-1:0,s<0?s=0:s>=this.rows&&(s=this.rows-1),e<0?e=0:e>=this.cols&&(e=this.cols-1),this.x=e,this.y=s},e.prototype.eraseInDisplay=function(t){var s;switch(t[0]){case 0:for(this.eraseRight(this.x,this.y),s=this.y+1;s<this.rows;s++)this.eraseLine(s);break;case 1:for(this.eraseLeft(this.x,this.y),s=this.y;s--;)this.eraseLine(s);break;case 2:for(s=this.rows;s--;)this.eraseLine(s);break;case 3:}},e.prototype.eraseInLine=function(t){switch(t[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y)}},e.prototype.charAttributes=function(t){if(1===t.length&&0===t[0])return void(this.curAttr=this.defAttr);for(var s,e=t.length,i=0,r=this.curAttr>>18,h=this.curAttr>>9&511,o=511&this.curAttr;i<e;i++)s=t[i],s>=30&&s<=37?h=s-30:s>=40&&s<=47?o=s-40:s>=90&&s<=97?(s+=8,h=s-90):s>=100&&s<=107?(s+=8,o=s-100):0===s?(r=this.defAttr>>18,h=this.defAttr>>9&511,o=511&this.defAttr):1===s?r|=1:4===s?r|=2:5===s?r|=4:7===s?r|=8:8===s?r|=16:22===s?r&=-2:24===s?r&=-3:25===s?r&=-5:27===s?r&=-9:28===s?r&=-17:39===s?h=this.defAttr>>9&511:49===s?o=511&this.defAttr:38===s?2===t[i+1]?(i+=2, h=l(255&t[i],255&t[i+1],255&t[i+2]),h===-1&&(h=511),i+=2):5===t[i+1]&&(i+=2,s=255&t[i],h=s):48===s?2===t[i+1]?(i+=2,o=l(255&t[i],255&t[i+1],255&t[i+2]),o===-1&&(o=511),i+=2):5===t[i+1]&&(i+=2,s=255&t[i],o=s):100===s?(h=this.defAttr>>9&511,o=511&this.defAttr):this.error("Unknown SGR attribute: %d.",s);this.curAttr=r<<18|h<<9|o},e.prototype.deviceStatus=function(t){if(this.prefix){if("?"===this.prefix)switch(t[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:}}else switch(t[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R")}},e.prototype.insertChars=function(t){var s,e,i,r;for(s=t[0],s<1&&(s=1),e=this.y+this.ybase,i=this.x,r=[this.eraseAttr()," "];s--&&i<this.cols;)this.lines[e].splice(i++,0,r),this.lines[e].pop()},e.prototype.cursorNextLine=function(t){var s=t[0];s<1&&(s=1),this.y+=s,this.y>=this.rows&&(this.y=this.rows-1),this.x=0},e.prototype.cursorPrecedingLine=function(t){var s=t[0];s<1&&(s=1),this.y-=s,this.y<0&&(this.y=0),this.x=0},e.prototype.cursorCharAbsolute=function(t){var s=t[0];s<1&&(s=1),this.x=s-1},e.prototype.insertLines=function(t){var s,e,i;for(s=t[0],s<1&&(s=1),e=this.y+this.ybase,i=this.rows-1-this.scrollBottom,i=this.rows-1+this.ybase-i+1;s--;)this.lines.splice(e,0,this.blankLine(!0)),this.lines.splice(i,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},e.prototype.deleteLines=function(t){var s,e,i;for(s=t[0],s<1&&(s=1),e=this.y+this.ybase,i=this.rows-1-this.scrollBottom,i=this.rows-1+this.ybase-i;s--;)this.lines.splice(i+1,0,this.blankLine(!0)),this.lines.splice(e,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},e.prototype.deleteChars=function(t){var s,e,i;for(s=t[0],s<1&&(s=1),e=this.y+this.ybase,i=[this.eraseAttr()," "];s--;)this.lines[e].splice(this.x,1),this.lines[e].push(i)},e.prototype.eraseChars=function(t){var s,e,i,r;for(s=t[0],s<1&&(s=1),e=this.y+this.ybase,i=this.x,r=[this.eraseAttr()," "];s--&&i<this.cols;)this.lines[e][i++]=r},e.prototype.charPosAbsolute=function(t){var s=t[0];s<1&&(s=1),this.x=s-1,this.x>=this.cols&&(this.x=this.cols-1)},e.prototype.HPositionRelative=function(t){var s=t[0];s<1&&(s=1),this.x+=s,this.x>=this.cols&&(this.x=this.cols-1)},e.prototype.sendDeviceAttributes=function(t){t[0]>0||(this.prefix?">"===this.prefix&&(this.is("xterm")?this.send("[>0;276;0c"):this.is("rxvt-unicode")?this.send("[>85;95;0c"):this.is("linux")?this.send(t[0]+"c"):this.is("screen")&&this.send("[>83;40003;0c")):this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("[?1;2c"):this.is("linux")&&this.send("[?6c"))},e.prototype.linePosAbsolute=function(t){var s=t[0];s<1&&(s=1),this.y=s-1,this.y>=this.rows&&(this.y=this.rows-1)},e.prototype.VPositionRelative=function(t){var s=t[0];s<1&&(s=1),this.y+=s,this.y>=this.rows&&(this.y=this.rows-1)},e.prototype.HVPosition=function(t){t[0]<1&&(t[0]=1),t[1]<1&&(t[1]=1),this.y=t[0]-1,this.y>=this.rows&&(this.y=this.rows-1),this.x=t[1]-1,this.x>=this.cols&&(this.x=this.cols-1)},e.prototype.setMode=function(t){if("object"!=typeof t)if(this.prefix){if("?"===this.prefix)switch(t){case 1:this.applicationCursor=!0;break;case 2:this.setgCharset(0,e.charsets.US),this.setgCharset(1,e.charsets.US),this.setgCharset(2,e.charsets.US),this.setgCharset(3,e.charsets.US);break;case 3:this.savedCols=this.cols,this.resize(132,this.rows);break;case 6:this.originMode=!0;break;case 7:this.wraparoundMode=!0;break;case 12:break;case 66:this.log("Serial port requested application keypad."),this.applicationKeypad=!0;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=9===t,this.vt200Mouse=1e3===t,this.normalMouse=t>1e3,this.mouseEvents=!0,this.element.style.cursor="default",this.log("Binding to mouse events.");break;case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;case 1049:case 47:case 1047:if(!this.normal){var s={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset(),this.normal=s,this.showCursor()}}}else switch(t){case 4:this.insertMode=!0;break;case 20:}else for(var i=t.length,r=0;r<i;r++)this.setMode(t[r])},e.prototype.resetMode=function(t){if("object"!=typeof t)if(this.prefix){if("?"===this.prefix)switch(t){case 1:this.applicationCursor=!1;break;case 3:132===this.cols&&this.savedCols&&this.resize(this.savedCols,this.rows),delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 12:break;case 66:this.log("Switching back to normal keypad."),this.applicationKeypad=!1;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=!1,this.vt200Mouse=!1,this.normalMouse=!1,this.mouseEvents=!1,this.element.style.cursor="";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),this.showCursor())}}else switch(t){case 4:this.insertMode=!1;break;case 20:}else for(var s=t.length,e=0;e<s;e++)this.resetMode(t[e])},e.prototype.setScrollRegion=function(t){this.prefix||(this.scrollTop=(t[0]||1)-1,this.scrollBottom=(t[1]||this.rows)-1,this.x=0,this.y=0)},e.prototype.saveCursor=function(t){this.savedX=this.x,this.savedY=this.y},e.prototype.restoreCursor=function(t){this.x=this.savedX||0,this.y=this.savedY||0},e.prototype.cursorForwardTab=function(t){for(var s=t[0]||1;s--;)this.x=this.nextStop()},e.prototype.scrollUp=function(t){for(var s=t[0]||1;s--;)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},e.prototype.scrollDown=function(t){for(var s=t[0]||1;s--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},e.prototype.initMouseTracking=function(t){},e.prototype.resetTitleModes=function(t){},e.prototype.cursorBackwardTab=function(t){for(var s=t[0]||1;s--;)this.x=this.prevStop()},e.prototype.repeatPrecedingCharacter=function(t){for(var s=t[0]||1,e=this.lines[this.ybase+this.y],i=e[this.x-1]||[this.defAttr," "];s--;)e[this.x++]=i},e.prototype.tabClear=function(t){var s=t[0];s<=0?delete this.tabs[this.x]:3===s&&(this.tabs={})},e.prototype.mediaCopy=function(t){},e.prototype.setResources=function(t){},e.prototype.disableModifiers=function(t){},e.prototype.setPointerMode=function(t){},e.prototype.softReset=function(t){this.cursorHidden=!1,this.insertMode=!1,this.originMode=!1,this.wraparoundMode=!1,this.applicationKeypad=!1,this.applicationCursor=!1,this.scrollTop=0,this.scrollBottom=this.rows-1,this.curAttr=this.defAttr,this.x=this.y=0,this.charset=null,this.glevel=0,this.charsets=[null]},e.prototype.requestAnsiMode=function(t){},e.prototype.requestPrivateMode=function(t){},e.prototype.setConformanceLevel=function(t){},e.prototype.loadLEDs=function(t){},e.prototype.setCursorStyle=function(t){},e.prototype.setCharProtectionAttr=function(t){},e.prototype.restorePrivateValues=function(t){},e.prototype.setAttrInRectangle=function(t){for(var s,e,i=t[0],r=t[1],h=t[2],o=t[3],a=t[4];i<h+1;i++)for(s=this.lines[this.ybase+i],e=r;e<o;e++)s[e]=[a,s[e][1]];this.updateRange(t[0]),this.updateRange(t[2])},e.prototype.savePrivateValues=function(t){},e.prototype.manipulateWindow=function(t){},e.prototype.reverseAttrInRectangle=function(t){},e.prototype.setTitleModeFeature=function(t){},e.prototype.setWarningBellVolume=function(t){},e.prototype.setMarginBellVolume=function(t){},e.prototype.copyRectangle=function(t){},e.prototype.enableFilterRectangle=function(t){},e.prototype.requestParameters=function(t){},e.prototype.selectChangeExtent=function(t){},e.prototype.fillRectangle=function(t){for(var s,e,i=t[0],r=t[1],h=t[2],o=t[3],a=t[4];r<o+1;r++)for(s=this.lines[this.ybase+r],e=h;e<a;e++)s[e]=[s[e][0],M.fromCharCode(i)];this.updateRange(t[1]),this.updateRange(t[3])},e.prototype.enableLocatorReporting=function(t){t[0]>0},e.prototype.eraseRectangle=function(t){var s,e,i,r=t[0],h=t[1],o=t[2],a=t[3];for(i=[this.eraseAttr()," "];r<o+1;r++)for(s=this.lines[this.ybase+r],e=h;e<a;e++)s[e]=i;this.updateRange(t[0]),this.updateRange(t[2])},e.prototype.setLocatorEvents=function(t){},e.prototype.selectiveEraseRectangle=function(t){},e.prototype.requestLocatorPosition=function(t){},e.prototype.insertColumns=function(){for(var t,s=params[0],e=this.ybase+this.rows,i=[this.eraseAttr()," "];s--;)for(t=this.ybase;t<e;t++)this.lines[t].splice(this.x+1,0,i),this.lines[t].pop();this.maxRange()},e.prototype.deleteColumns=function(){for(var t,s=params[0],e=this.ybase+this.rows,i=[this.eraseAttr()," "];s--;)for(t=this.ybase;t<e;t++)this.lines[t].splice(this.x,1),this.lines[t].push(i);this.maxRange()},e.prototype.enterPrefix=function(){this.prefixMode=!0},e.prototype.leavePrefix=function(){this.prefixMode=!1},e.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write},this.write=function(){},this.selectMode=!0,this.visualMode=!1,this.cursorHidden=!1,this.refresh(this.y,this.y)},e.prototype.leaveSelect=function(){this.x=this._real.x,this.y=this._real.y,this.ydisp=this._real.ydisp,this.ybase=this._real.ybase,this.cursorHidden=this._real.cursorHidden,this.lines=this._real.lines,this.write=this._real.write,delete this._real,this.selectMode=!1,this.visualMode=!1,this.refresh(0,this.rows-1)},e.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines),this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y),this.visualMode=!0},e.prototype.leaveVisual=function(){this.lines=this._real.preVisual,delete this._real.preVisual,delete this._selected,this.visualMode=!1,this.refresh(0,this.rows-1)},e.prototype.enterSearch=function(t){this.entry="",this.searchMode=!0,this.searchDown=t,this._real.preSearch=this.copyBuffer(this.lines),this._real.preSearchX=this.x,this._real.preSearchY=this.y;for(var s=this.ydisp+this.rows-1,e=0;e<this.entryPrefix.length;e++)this.lines[s][e]=[this.defAttr&-512|4,this.entryPrefix[e]];this.y=this.rows-1,this.x=this.entryPrefix.length,this.refresh(this.rows-1,this.rows-1)},e.prototype.leaveSearch=function(){this.searchMode=!1,this._real.preSearch&&(this.lines=this._real.preSearch,this.x=this._real.preSearchX,this.y=this._real.preSearchY,delete this._real.preSearch,delete this._real.preSearchX,delete this._real.preSearchY),this.refresh(this.rows-1,this.rows-1)},e.prototype.copyBuffer=function(t){for(var t=t||this.lines,s=[],e=0;e<t.length;e++){s[e]=[];for(var i=0;i<t[e].length;i++)s[e][i]=[t[e][i][0],t[e][i][1]]}return s},e.prototype.getCopyTextarea=function(t){var s=this._copyTextarea,e=this.document;return s||(s=e.createElement("textarea"),s.style.position="absolute",s.style.left="-32000px",s.style.top="-32000px",s.style.width="0px",s.style.height="0px",s.style.opacity="0",s.style.backgroundColor="transparent",s.style.borderStyle="none",s.style.outlineStyle="none",e.getElementsByTagName("body")[0].appendChild(s),this._copyTextarea=s),s},e.prototype.copyText=function(t){var s=this,e=this.getCopyTextarea();this.emit("copy",t),e.focus(),e.textContent=t,e.value=t,e.setSelectionRange(0,t.length),C(function(){s.element.focus(),s.focus()},1)},e.prototype.selectText=function(t,s,e,i){var r,h,o,a,n,c,l,p,u;if(this._selected){for(r=this._selected.x1,h=this._selected.x2,o=this._selected.y1,a=this._selected.y2,a<o&&(n=h,h=r,r=n,n=a,a=o,o=n),h<r&&o===a&&(n=h,h=r,r=n),l=o;l<=a;l++)for(c=0,p=this.cols-1,l===o&&(c=r),l===a&&(p=h);c<=p;c++)null!=this.lines[l][c].old&&(u=this.lines[l][c].old,delete this.lines[l][c].old,this.lines[l][c]=[u,this.lines[l][c][1]]);e=this._selected.y1,t=this._selected.x1}for(e=Math.max(e,0),e=Math.min(e,this.ydisp+this.rows-1),i=Math.max(i,0),i=Math.min(i,this.ydisp+this.rows-1),this._selected={x1:t,x2:s,y1:e,y2:i},i<e&&(n=s,s=t,t=n,n=i,i=e,e=n),s<t&&e===i&&(n=s,s=t,t=n),l=e;l<=i;l++)for(c=0,p=this.cols-1,l===e&&(c=t),l===i&&(p=s);c<=p;c++)u=this.lines[l][c][0],this.lines[l][c]=[u&-512|261636,this.lines[l][c][1]],this.lines[l][c].old=u;e-=this.ydisp,i-=this.ydisp,e=Math.max(e,0),e=Math.min(e,this.rows-1),i=Math.max(i,0),i=Math.min(i,this.rows-1),this.refresh(0,this.rows-1)},e.prototype.grabText=function(t,s,e,i){var r,h,o,a,n,l="",p="";for(i<e&&(n=s,s=t,t=n,n=i,i=e,e=n),s<t&&e===i&&(n=s,s=t,t=n),o=e;o<=i;o++){for(h=0,a=this.cols-1,o===e&&(h=t),o===i&&(a=s);h<=a;h++)r=this.lines[o][h][1]," "!==r?(p&&(l+=p,p=""),l+=r,c(r)&&h++):p+=r;p="",l+="\n"}for(h=s,o=i;h<this.cols;h++)if(" "!==this.lines[o][h][1]){l=l.slice(0,-1);break}return l},e.prototype.keyPrefix=function(t,s){"k"===s||"&"===s?this.destroy():"p"===s||"]"===s?this.emit("request paste"):"c"===s?this.emit("request create"):s>="0"&&s<="9"?(s=+s-1,~s||(s=9),this.emit("request term",s)):"n"===s?this.emit("request term next"):"P"===s?this.emit("request term previous"):":"===s?this.emit("request command mode"):"["===s&&this.enterSelect()},e.prototype.keySelect=function(t,s){if(this.showCursor(),this.searchMode||"n"===s||"N"===s)return this.keySearch(t,s);if(""===s){var e=this.ydisp+this.y;return this.ydisp===this.ybase?(this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1),this.refresh(0,this.rows-1)):this.scrollDisp((this.rows-1)/2|0),void(this.visualMode&&this.selectText(this.x,this.x,e,this.ydisp+this.y))}if(""===s){var e=this.ydisp+this.y;return 0===this.ydisp?(this.y=Math.max(this.y-(this.rows-1)/2|0,0),this.refresh(0,this.rows-1)):this.scrollDisp(-(this.rows-1)/2|0),void(this.visualMode&&this.selectText(this.x,this.x,e,this.ydisp+this.y))}if(""===s){var e=this.ydisp+this.y;return this.scrollDisp(this.rows-1),void(this.visualMode&&this.selectText(this.x,this.x,e,this.ydisp+this.y))}if(""===s){var e=this.ydisp+this.y;return this.scrollDisp(-(this.rows-1)),void(this.visualMode&&this.selectText(this.x,this.x,e,this.ydisp+this.y))}if("k"===s||"[A"===s){var e=this.ydisp+this.y;return this.y--,this.y<0&&(this.y=0,this.scrollDisp(-1)),void(this.visualMode?this.selectText(this.x,this.x,e,this.ydisp+this.y):this.refresh(this.y,this.y+1))}if("j"===s||"[B"===s){var e=this.ydisp+this.y;return this.y++,this.y>=this.rows&&(this.y=this.rows-1,this.scrollDisp(1)),void(this.visualMode?this.selectText(this.x,this.x,e,this.ydisp+this.y):this.refresh(this.y-1,this.y))}if("h"===s||"[D"===s){var i=this.x;return this.x--,this.x<0&&(this.x=0),void(this.visualMode?this.selectText(i,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("l"===s||"[C"===s){var i=this.x;return this.x++,this.x>=this.cols&&(this.x=this.cols-1),void(this.visualMode?this.selectText(i,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("v"===s||" "===s)return void(this.visualMode?this.leaveVisual():this.enterVisual());if("y"!==s){if("q"===s||""===s)return void(this.visualMode?this.leaveVisual():this.leaveSelect());if("w"===s||"W"===s){for(var r=this.x,h=this.y,o=this.ydisp,i=this.x,e=this.y,a=this.ydisp,n=!1;;){for(var c=this.lines[a+e];i<this.cols;){if(c[i][1]<=" ")n=!0;else if(n)break;i++}if(i>=this.cols&&(i=this.cols-1),!(i===this.cols-1&&c[i][1]<=" "))break;if(i=0,++e>=this.rows&&(e--,++a>this.ybase)){a=this.ybase,i=this.x;break}}return this.x=i,this.y=e,this.scrollDisp(-this.ydisp+a),void(this.visualMode&&this.selectText(r,this.x,h+o,this.ydisp+this.y))}if("b"===s||"B"===s){for(var r=this.x,h=this.y,o=this.ydisp,i=this.x,e=this.y,a=this.ydisp;;){for(var c=this.lines[a+e],n=i>0&&c[i][1]>" "&&c[i-1][1]>" ";i>=0;){if(c[i][1]<=" "){if(n&&i+1<this.cols&&c[i+1][1]>" "){i++;break}n=!0}i--}if(i<0&&(i=0),0!==i||!(c[i][1]<=" ")&&n)break;if(i=this.cols-1,--e<0&&(e++,--a<0)){a++,i=0;break}}return this.x=i,this.y=e,this.scrollDisp(-this.ydisp+a),void(this.visualMode&&this.selectText(r,this.x,h+o,this.ydisp+this.y))}if("e"===s||"E"===s){var i=this.x+1,e=this.y,a=this.ydisp;for(i>=this.cols&&i--;;){for(var c=this.lines[a+e];i<this.cols&&c[i][1]<=" ";)i++;for(;i<this.cols;){if(c[i][1]<=" "&&i-1>=0&&c[i-1][1]>" "){i--;break}i++}if(i>=this.cols&&(i=this.cols-1),!(i===this.cols-1&&c[i][1]<=" "))break;if(i=0,++e>=this.rows&&(e--,++a>this.ybase)){a=this.ybase;break}}return this.x=i,this.y=e,this.scrollDisp(-this.ydisp+a),void(this.visualMode&&this.selectText(r,this.x,h+o,this.ydisp+this.y))}if("^"===s||"0"===s){var r=this.x;if("0"===s)this.x=0;else if("^"===s){for(var c=this.lines[this.ydisp+this.y],i=0;i<this.cols&&!(c[i][1]>" ");)i++;i>=this.cols&&(i=this.cols-1),this.x=i}return void(this.visualMode?this.selectText(r,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("$"===s){for(var r=this.x,c=this.lines[this.ydisp+this.y],i=this.cols-1;i>=0;){if(c[i][1]>" "){this.visualMode&&i<this.cols-1&&i++;break}i--}return i<0&&(i=0),this.x=i,void(this.visualMode?this.selectText(r,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y))}if("g"===s||"G"===s){var r=this.x,h=this.y,o=this.ydisp;return"g"===s?(this.x=0,this.y=0,this.scrollDisp(-this.ydisp)):"G"===s&&(this.x=0,this.y=this.rows-1,this.scrollDisp(this.ybase)),void(this.visualMode&&this.selectText(r,this.x,h+o,this.ydisp+this.y))}if("H"===s||"M"===s||"L"===s){var r=this.x,h=this.y;return"H"===s?(this.x=0,this.y=0):"M"===s?(this.x=0,this.y=this.rows/2|0):"L"===s&&(this.x=0,this.y=this.rows-1),void(this.visualMode?this.selectText(r,this.x,this.ydisp+h,this.ydisp+this.y):(this.refresh(h,h),this.refresh(this.y,this.y)))}if("{"===s||"}"===s){var c,l,r=this.x,h=this.y,o=this.ydisp,p=!1,u=!1,f=-1,e=this.y+("{"===s?-1:1),a=this.ydisp;for("{"===s?e<0&&(e++,a>0&&a--):"}"===s&&e>=this.rows&&(e--,a<this.ybase&&a++);;){for(c=this.lines[a+e],l=0;l<this.cols;l++){if(c[l][1]>" "){f===-1&&(f=0),p=!0;break}if(l===this.cols-1){f===-1?f=1:0===f?u=!0:1===f&&p&&(u=!0);break}}if(u)break;if("{"===s){if(e--,e<0){if(e++,!(a>0))break;a--}}else if("}"===s&&(e++,e>=this.rows)){if(e--,!(a<this.ybase))break;a++}}return u||("{"===s?(e=0,a=0):"}"===s&&(e=this.rows-1,a=this.ybase)),this.x=0,this.y=e,this.scrollDisp(-this.ydisp+a),void(this.visualMode&&this.selectText(r,this.x,h+o,this.ydisp+this.y))}return("/"===s||"?"===s)&&void(this.visualMode||this.enterSearch("/"===s))}if(this.visualMode){var y=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2);this.copyText(y),this.leaveVisual()}},e.prototype.keySearch=function(t,s){if(""===s)return void this.leaveSearch();if("\r"===s||!this.searchMode&&("n"===s||"N"===s)){this.leaveSearch();var e=this.entry;if(!e)return void this.refresh(0,this.rows-1);for(var i,r,h,o=this.x,a=this.y,n=this.ydisp,c=!1,l=!1,p=this.x+1,u=this.ydisp+this.y,f="N"===s?this.searchDown:!this.searchDown;;){for(i=this.lines[u];p<this.cols;){for(h=0;h<e.length&&!(p+h>=this.cols)&&i[p+h][1]===e[h];h++)if(i[p+h][1]===e[h]&&h===e.length-1){c=!0;break}if(c)break;p+=h+1}if(c)break;if(p=0,f){if(u--,u<0){if(l)break;l=!0,u=this.ybase+this.rows-1}}else if(u++,u>this.ybase+this.rows-1){if(l)break;l=!0,u=0}}return c?(u-this.ybase<0?(r=u,u=0,r>this.ybase&&(u=r-this.ybase,r=this.ybase)):(r=this.ybase,u-=this.ybase),this.x=p,this.y=u,this.scrollDisp(-this.ydisp+r),void(this.visualMode&&this.selectText(o,this.x,a+n,this.ydisp+this.y))):void this.refresh(0,this.rows-1)}if("\b"===s||""===s){if(0===this.entry.length)return;var y=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,-1);var h=this.entryPrefix.length+this.entry.length;return this.lines[y][h]=[this.lines[y][h][0]," "],this.x--,this.refresh(this.rows-1,this.rows-1),void this.refresh(this.y,this.y)}if(1===s.length&&s>=" "&&s<="~"){var y=this.ydisp+this.rows-1;this.entry+=s;var h=this.entryPrefix.length+this.entry.length-1;return this.lines[y][h]=[this.defAttr&-512|4,s],this.x++,this.refresh(this.rows-1,this.rows-1),void this.refresh(this.y,this.y)}return!1},e.charsets={},e.charsets.SCLD={"`":"‚óÜ",a:"‚ñí",b:"\t",c:"\f",d:"\r",e:"\n",f:"¬∞",g:"¬±",h:"‚ê§",i:"\v",j:"‚îò",k:"‚îê",l:"‚îå",m:"‚îî",n:"‚îº",o:"‚é∫",p:"‚éª",q:"‚îÄ",r:"‚éº",s:"‚éΩ",t:"‚îú",u:"‚î§",v:"‚î¥",w:"‚î¨",x:"‚îÇ",y:"‚â§",z:"‚â•","{":"œÄ","|":"‚â†","}":"¬£","~":"¬∑"},e.charsets.UK=null,e.charsets.US=null,e.charsets.Dutch=null,e.charsets.Finnish=null,e.charsets.French=null,e.charsets.FrenchCanadian=null,e.charsets.German=null,e.charsets.Italian=null,e.charsets.NorwegianDanish=null,e.charsets.Spanish=null,e.charsets.Swedish=null,e.charsets.Swiss=null,e.charsets.ISOLatin=null;var M=this.String,C=this.setTimeout,S=this.setInterval;l._cache={},l.distance=function(t,s,e,i,r,h){return Math.pow(30*(t-i),2)+Math.pow(59*(s-r),2)+Math.pow(11*(e-h),2)},e.EventEmitter=t,e.Stream=s,e.inherits=o,e.on=i,e.off=r,e.cancel=h,"undefined"!=typeof module?module.exports=e:this.Terminal=e}).call(function(){return this||("undefined"!=typeof window?window:global)}());</script> <script>var saveAs=saveAs||function(e){"use strict";if(!("undefined"==typeof e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement),d=/CriOS\/[\d]+/.test(navigator.userAgent),f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",s=4e4,c=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,s)},l=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){f(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},v=function(t,f,s){s||(t=p(t));var v,w=this,m=t.type,y=m===u,h=function(){l(w,"writestart progress write writeend".split(" "))},S=function(){if((d||y&&i)&&e.FileReader){var o=new FileReader;return o.onloadend=function(){var t=d?o.result:o.result.replace(/^data:[^;]*;/,"data:attachment/file;"),n=e.open(t,"_blank");n||(e.location.href=t),t=void 0,w.readyState=w.DONE,h()},o.readAsDataURL(t),void(w.readyState=w.INIT)}if(v||(v=n().createObjectURL(t)),y)e.location.href=v;else{var r=e.open(v,"_blank");r||(e.location.href=v)}w.readyState=w.DONE,h(),c(v)};return w.readyState=w.INIT,r?(v=n().createObjectURL(t),void setTimeout(function(){o.href=v,o.download=f,a(o),h(),c(v),w.readyState=w.DONE})):void S()},w=v.prototype,m=function(e,t,n){return new v(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=p(e)),navigator.msSaveOrOpenBlob(e,t)}:(w.abort=function(){},w.readyState=w.INIT=0,w.WRITING=1,w.DONE=2,w.error=w.onwritestart=w.onprogress=w.onwrite=w.onabort=w.onerror=w.onwriteend=null,m)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});</script> </head> <body> <div style="display:inline-block;vertical-align:top;"> <form> <input type="text" name="webrepl_url" id="url" value="ws://192.168.4.1:8266/"> <input type="submit" id="button" value="Connect" onclick="button_click(); return false;"> </form> <div id="term"> </div> </div> <div id="file-boxes" style="display:inline-block;vertical-align:top;width:230px;"> <div class="file-box"> <strong>Send a file</strong> <input type="file" id="put-file-select"> <div id="put-file-list"></div> <input type="button" value="Send to device" id="put-file-button" onclick="put_file(); return false;"> </div> <div class="file-box"> <strong>Get a file</strong> <input type="text" name="get_filename" id="get_filename" value="" size="13"> <input type="button" value="Get from device" onclick="get_file(); return false;"> </div> <div class="file-box" id="file-status"><span style="color:#707070">(file operation status)</span></div> </div> <br clear="both"> <i>Terminal widget should be focused (text cursor visible) to accept input. Click on it if not.</i><br> <i>To paste, press Ctrl+A, then Ctrl+V</i> </body> <script>function calculate_size(e){var t=0|Math.max(80,Math.min(150,(e.innerWidth-280)/7)),n=0|Math.max(24,Math.min(80,(e.innerHeight-180)/12));return[t,n]}function show_https_warning(){if("https:"==window.location.protocol){var e=document.createElement("div");e.style.cssText="background:#f99;padding:5px;margin-bottom:10px;line-height:1.5em;text-align:center",e.innerHTML=["At this time, the WebREPL client cannot be accessed over HTTPS connections.",'Use a HTTP connection, eg. <a href="http://micropython.org/webrepl/">http://micropython.org/webrepl/</a>.','Alternatively, download the files from <a href="https://github.com/micropython/webrepl">GitHub</a> and run them locally.'].join("<br>"),document.body.insertBefore(e,document.body.childNodes[0]),term.resize(term.cols,term.rows-7)}}function button_click(){connected?ws.close():(document.getElementById("url").disabled=!0,document.getElementById("button").value="Disconnect",connected=!0,connect(document.getElementById("url").value))}function prepare_for_connect(){document.getElementById("url").disabled=!1,document.getElementById("button").value="Connect"}function update_file_status(e){document.getElementById("file-status").innerHTML=e}function connect(e){ws=new WebSocket(e),ws.binaryType="arraybuffer",ws.onopen=function(){term.removeAllListeners("data"),term.on("data",function(e){e=e.replace(/\n/g,"\r"),ws.send(e)}),term.on("title",function(e){document.title=e}),term.focus(),term.element.focus(),term.write("[31mWelcome to MicroPython![m\r\n"),ws.onmessage=function(e){if(e.data instanceof ArrayBuffer){var t=new Uint8Array(e.data);switch(binary_state){case 11:if(0==decode_resp(t)){for(var n=0;n<put_file_data.length;n+=1024)ws.send(put_file_data.slice(n,n+1024));binary_state=12}break;case 12:update_file_status(0==decode_resp(t)?"Sent "+put_file_name+", "+put_file_data.length+" bytes":"Failed sending "+put_file_name),binary_state=0;break;case 21:if(0==decode_resp(t)){binary_state=22;var a=new Uint8Array(1);a[0]=0,ws.send(a)}break;case 22:var i=t[0]|t[1]<<8;if(t.length==2+i)if(0==i)binary_state=23;else{var r=new Uint8Array(get_file_data.length+i);r.set(get_file_data),r.set(t.slice(2),get_file_data.length),get_file_data=r,update_file_status("Getting "+get_file_name+", "+get_file_data.length+" bytes");var a=new Uint8Array(1);a[0]=0,ws.send(a)}else binary_state=0;break;case 23:0==decode_resp(t)?(update_file_status("Got "+get_file_name+", "+get_file_data.length+" bytes"),saveAs(new Blob([get_file_data],{type:"application/octet-stream"}),get_file_name)):update_file_status("Failed getting "+get_file_name),binary_state=0;break;case 31:console.log("GET_VER",t),binary_state=0}}term.write(e.data)}},ws.onclose=function(){connected=!1,term&&term.write("[31mDisconnected[m\r\n"),term.off("data"),prepare_for_connect()}}function decode_resp(e){if(e[0]=="W".charCodeAt(0)&&e[1]=="B".charCodeAt(0)){var t=e[2]|e[3]<<8;return t}return-1}function put_file(){var e=put_file_name,t=put_file_data.length,n=new Uint8Array(82);n[0]="W".charCodeAt(0),n[1]="A".charCodeAt(0),n[2]=1,n[3]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=0,n[11]=0,n[12]=255&t,n[13]=t>>8&255,n[14]=t>>16&255,n[15]=t>>24&255,n[16]=255&e.length,n[17]=e.length>>8&255;for(var a=0;a<64;++a)a<e.length?n[18+a]=e.charCodeAt(a):n[18+a]=0;binary_state=11,update_file_status("Sending "+put_file_name+"..."),ws.send(n)}function get_file(){var e=document.getElementById("get_filename").value,t=new Uint8Array(82);t[0]="W".charCodeAt(0),t[1]="A".charCodeAt(0),t[2]=2,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=0,t[16]=255&e.length,t[17]=e.length>>8&255;for(var n=0;n<64;++n)n<e.length?t[18+n]=e.charCodeAt(n):t[18+n]=0;binary_state=21,get_file_name=e,get_file_data=new Uint8Array(0),update_file_status("Getting "+get_file_name+"..."),ws.send(t)}function get_ver(){var e=new Uint8Array(82);e[0]="W".charCodeAt(0),e[1]="A".charCodeAt(0),e[2]=3,binary_state=31,ws.send(e)}function handle_put_file_select(e){var t=e.target.files,n=t[0];put_file_name=n.name;var a=new FileReader;a.onload=function(e){put_file_data=new Uint8Array(e.target.result),document.getElementById("put-file-list").innerHTML=""+escape(put_file_name)+" - "+put_file_data.length+" bytes",document.getElementById("put-file-button").disabled=!1},a.readAsArrayBuffer(n)}var term,ws,connected=!1,binary_state=0,put_file_name=null,put_file_data=null,get_file_name=null,get_file_data=null;(function(){window.onload=function(){document.getElementById('url').value='ws://'+window.location.hostname+':8266/';var e=calculate_size(self);term=new Terminal({cols:e[0],rows:e[1],useStyle:!0,screenKeys:!0,cursorBlink:!1}),term.open(document.getElementById("term")),show_https_warning()},window.addEventListener("resize",function(){var e=calculate_size(self);term.resize(e[0],e[1])})}).call(this),document.getElementById("put-file-select").addEventListener("click",function(){this.value=null},!1),document.getElementById("put-file-select").addEventListener("change",handle_put_file_select,!1),document.getElementById("put-file-button").disabled=!0;</script> </html> 
